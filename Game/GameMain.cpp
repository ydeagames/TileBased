#include "GameMain.h"
#include <cmath>
#include "TitleScene.h"
#include "PlayScene.h"
#include "ResultScene.h"

// <Gameクラス>

// ゲームの初期化処理
Game::Game() :
	m_frame_timer(new FrameTimer)
{
	Time::GetInstance().InitializeTime();

	SceneManager& scene_manager = SceneManager::GetInstance();

	scene_manager.AddScene<TitleScene>(SceneID::LOGO);
	scene_manager.AddScene<TitleScene>(SceneID::TITLE);
	scene_manager.AddScene<PlayScene>(SceneID::PLAY);
	scene_manager.AddScene<ResultScene>(SceneID::RESULT);

	scene_manager.SetStartScene(SceneID::LOGO);
}

// ゲームの終了処理
Game::~Game()
{
	delete m_frame_timer;
}

// ゲームの更新処理
void Game::Update(void)
{
	m_frame_timer->Update();
	Timer::Tick();
	Time::GetInstance().UpdateTime();

	InputManager::GetInstance().Update();

	SceneManager::GetInstance().UpdateActiveScene();
}

// ゲームの描画処理
void Game::Render(void)
{
	SceneManager::GetInstance().RenderActiveScene();

#ifdef _DEBUG
	DrawFormatString(10, 10, Colors::White, "FPS = %f", m_frame_timer->GetFrameRate());
#endif
}

Screen::Screen()
	: title("")
	, size(Vector2{})
{
	SetTitle("マップチップ");
	SetSize(Vector2(640, 480));
}

void Screen::SetTitle(const std::string & newtitle)
{
	SetMainWindowText(newtitle.c_str());
	title = newtitle;
}

void Screen::SetSize(const Vector2 & newsize)
{
	SetWindowSize(static_cast<int>(newsize.x), static_cast<int>(newsize.y));
	size = newsize;
}
